<!DOCTYPE html>
<html lang="en">
<head>
    <script src="objectDefaultFiles/object.js"></script>
    <script src="objectDefaultFiles/pep.min.js"></script>
    <script src="objectDefaultFiles/envelopeContents.js"></script>
    <meta charset="UTF-8">
    <title>slider-2d</title>
    <style>
        #handleContainer {
            position: absolute;
            left: 0;
            top: 0;
            width: 694px;
        }
    </style>
</head>
<body style="width: 694px; height: 694px">

<svg id="container" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 157.96 157.96">
    <defs>
        <style>
            .cls-1 {
                opacity: 0.5;
            }

            .cls-2 {
                opacity: 0.25;
            }

            .cls-3 {
                fill: #75fbfd;
            }

            .cls-4 {
                fill: #6ff;
            }
        </style>
    </defs>
    <title>Asset 44</title>
    <g id="Layer_2" data-name="Layer 2">
        <g id="UI">
            <g>
                <g>
                    <g>
                        <g class="cls-1">
                            <path d="M78.42,155.35a.69.69,0,0,0,1.12,0L104,121.88a3.44,3.44,0,0,0,.67-2V112.5a.7.7,0,0,0-.7-.7H103a.71.71,0,0,0-.5.21h0L90.79,123.72a5.74,5.74,0,0,1-4.11,1.7H71.28a5.77,5.77,0,0,1-4.11-1.7L55.46,112a.71.71,0,0,0-.49-.21H54a.7.7,0,0,0-.7.7v7.33a3.44,3.44,0,0,0,.67,2Z"/>
                        </g>
                        <g class="cls-2">
                            <path class="cls-3" d="M101.85,116.6v3.23a.69.69,0,0,1-.13.41L79,151.39,56.24,120.24a.69.69,0,0,1-.13-.41V116.6l9.09,9.09a8.51,8.51,0,0,0,6.08,2.52h15.4a8.51,8.51,0,0,0,6.08-2.52l9.09-9.09m2.09-4.8H103a.71.71,0,0,0-.5.21h0L90.79,123.72a5.74,5.74,0,0,1-4.11,1.7H71.28a5.77,5.77,0,0,1-4.11-1.7L55.46,112a.71.71,0,0,0-.49-.21H54a.7.7,0,0,0-.7.7v7.33a3.44,3.44,0,0,0,.67,2l24.43,33.47a.69.69,0,0,0,1.12,0L104,121.88a3.44,3.44,0,0,0,.67-2V112.5a.7.7,0,0,0-.7-.7Z"/>
                        </g>
                    </g>
                    <path class="cls-3" d="M52.11,123.25l24.43,33.47a3,3,0,0,0,4.88,0l24.43-33.47a5.76,5.76,0,0,0,1.12-3.42V112.5a3,3,0,0,0-3-3H103a3,3,0,0,0-2.14.89h0L89.15,122.08a3.56,3.56,0,0,1-2.47,1H71.28a3.51,3.51,0,0,1-2.47-1L57.1,110.37a3,3,0,0,0-2.13-.89H54a3,3,0,0,0-3,3v7.33A5.75,5.75,0,0,0,52.11,123.25ZM55.46,112l11.71,11.71a5.77,5.77,0,0,0,4.11,1.7h15.4a5.74,5.74,0,0,0,4.11-1.7L102.5,112h0a.71.71,0,0,1,.5-.21h.94a.7.7,0,0,1,.7.7v7.33a3.44,3.44,0,0,1-.67,2L79.54,155.35a.69.69,0,0,1-1.12,0L54,121.88a3.44,3.44,0,0,1-.67-2V112.5a.7.7,0,0,1,.7-.7H55A.71.71,0,0,1,55.46,112Z"/>
                </g>
                <g>
                    <g>
                        <g class="cls-1">
                            <path d="M79.54,2.61a.69.69,0,0,0-1.12,0L54,36.08a3.45,3.45,0,0,0-.67,2.06v7.32a.7.7,0,0,0,.7.7H55a.71.71,0,0,0,.49-.21h0L67.17,34.24a5.77,5.77,0,0,1,4.11-1.7h15.4a5.74,5.74,0,0,1,4.11,1.7L102.5,46a.71.71,0,0,0,.5.21h.94a.7.7,0,0,0,.7-.7V38.14a3.45,3.45,0,0,0-.67-2.06Z"/>
                        </g>
                        <g class="cls-2">
                            <path class="cls-3" d="M79,6.57l22.74,31.15a.7.7,0,0,1,.13.42v3.22l-9.08-9.09a8.59,8.59,0,0,0-6.09-2.52H71.28a8.55,8.55,0,0,0-6.08,2.52l-9.09,9.09V38.14a.7.7,0,0,1,.13-.42L79,6.57m0-4.25a.68.68,0,0,0-.56.29L54,36.08a3.45,3.45,0,0,0-.67,2.06v7.32a.7.7,0,0,0,.7.7H55a.71.71,0,0,0,.49-.21h0L67.17,34.24a5.77,5.77,0,0,1,4.11-1.7h15.4a5.74,5.74,0,0,1,4.11,1.7L102.5,46a.71.71,0,0,0,.5.21h.94a.7.7,0,0,0,.7-.7V38.14a3.45,3.45,0,0,0-.67-2.06L79.54,2.61A.68.68,0,0,0,79,2.32Z"/>
                        </g>
                    </g>
                    <path class="cls-3" d="M105.85,34.71,81.42,1.24a3,3,0,0,0-4.88,0L52.11,34.71A5.78,5.78,0,0,0,51,38.14v7.32a3,3,0,0,0,3,3H55a3,3,0,0,0,2.13-.88h0L68.81,35.89a3.52,3.52,0,0,1,2.47-1h15.4a3.48,3.48,0,0,1,2.47,1L100.86,47.6a3,3,0,0,0,2.14.88h.94a3,3,0,0,0,3-3V38.14A5.79,5.79,0,0,0,105.85,34.71ZM102.5,46,90.79,34.24a5.74,5.74,0,0,0-4.11-1.7H71.28a5.77,5.77,0,0,0-4.11,1.7L55.46,46h0a.71.71,0,0,1-.49.21H54a.7.7,0,0,1-.7-.7V38.14A3.45,3.45,0,0,1,54,36.08L78.42,2.61a.69.69,0,0,1,1.12,0L104,36.08a3.45,3.45,0,0,1,.67,2.06v7.32a.7.7,0,0,1-.7.7H103A.71.71,0,0,1,102.5,46Z"/>
                </g>
                <g>
                    <g>
                        <g class="cls-1">
                            <path d="M2.61,78.42a.69.69,0,0,0,0,1.12L36.08,104a3.45,3.45,0,0,0,2.06.67h7.32a.7.7,0,0,0,.7-.7V103a.71.71,0,0,0-.21-.5h0L34.24,90.79a5.74,5.74,0,0,1-1.7-4.11V71.28a5.77,5.77,0,0,1,1.7-4.11L46,55.46a.71.71,0,0,0,.21-.49V54a.7.7,0,0,0-.7-.7H38.14a3.45,3.45,0,0,0-2.06.67Z"/>
                        </g>
                        <g class="cls-2">
                            <path class="cls-3" d="M41.36,56.11,32.27,65.2a8.55,8.55,0,0,0-2.52,6.08v15.4a8.55,8.55,0,0,0,2.52,6.08l9.09,9.09H38.14a.7.7,0,0,1-.42-.13L6.57,79,37.72,56.24a.7.7,0,0,1,.42-.13h3.22m4.1-2.79H38.14a3.45,3.45,0,0,0-2.06.67L2.61,78.42a.69.69,0,0,0,0,1.12L36.08,104a3.45,3.45,0,0,0,2.06.67h7.32a.7.7,0,0,0,.7-.7V103a.71.71,0,0,0-.21-.5h0L34.24,90.79a5.74,5.74,0,0,1-1.7-4.11V71.28a5.77,5.77,0,0,1,1.7-4.11L46,55.46a.71.71,0,0,0,.21-.49V54a.7.7,0,0,0-.7-.7Z"/>
                        </g>
                    </g>
                    <path class="cls-3" d="M34.71,52.11,1.24,76.54a3,3,0,0,0,0,4.88l33.47,24.43A5.79,5.79,0,0,0,38.14,107h7.32a3,3,0,0,0,3-3V103a3,3,0,0,0-.88-2.14h0L35.89,89.15a3.52,3.52,0,0,1-1-2.47V71.28a3.48,3.48,0,0,1,1-2.47L47.6,57.1A3,3,0,0,0,48.48,55V54a3,3,0,0,0-3-3H38.14A5.78,5.78,0,0,0,34.71,52.11ZM46,55.46,34.24,67.17a5.77,5.77,0,0,0-1.7,4.11v15.4a5.74,5.74,0,0,0,1.7,4.11L46,102.5h0a.71.71,0,0,1,.21.5v.94a.7.7,0,0,1-.7.7H38.14a3.45,3.45,0,0,1-2.06-.67L2.61,79.54a.69.69,0,0,1,0-1.12L36.08,54a3.45,3.45,0,0,1,2.06-.67h7.32a.7.7,0,0,1,.7.7V55A.71.71,0,0,1,46,55.46Z"/>
                </g>
                <g>
                    <g>
                        <g class="cls-1">
                            <path d="M155.35,79.54a.69.69,0,0,0,0-1.12L121.88,54a3.44,3.44,0,0,0-2-.67H112.5a.7.7,0,0,0-.7.7V55a.71.71,0,0,0,.21.49h0l11.71,11.71a5.77,5.77,0,0,1,1.7,4.11v15.4a5.74,5.74,0,0,1-1.7,4.11L112,102.5a.71.71,0,0,0-.21.5v.94a.7.7,0,0,0,.7.7h7.33a3.44,3.44,0,0,0,2-.67Z"/>
                        </g>
                        <g class="cls-2">
                            <path class="cls-3" d="M119.83,56.11a.69.69,0,0,1,.41.13L151.39,79l-31.15,22.74a.69.69,0,0,1-.41.13H116.6l9.09-9.08a8.55,8.55,0,0,0,2.52-6.09V71.28a8.51,8.51,0,0,0-2.52-6.08l-9.09-9.09h3.23m0-2.79H112.5a.7.7,0,0,0-.7.7V55a.71.71,0,0,0,.21.49h0l11.71,11.71a5.77,5.77,0,0,1,1.7,4.11v15.4a5.74,5.74,0,0,1-1.7,4.11L112,102.5a.71.71,0,0,0-.21.5v.94a.7.7,0,0,0,.7.7h7.33a3.44,3.44,0,0,0,2-.67l33.47-24.43a.69.69,0,0,0,0-1.12L121.88,54a3.44,3.44,0,0,0-2-.67Z"/>
                        </g>
                    </g>
                    <path class="cls-3" d="M123.25,105.85l33.47-24.43a3,3,0,0,0,0-4.88L123.25,52.11A5.75,5.75,0,0,0,119.83,51H112.5a3,3,0,0,0-3,3V55a3,3,0,0,0,.89,2.13h0l11.71,11.71a3.56,3.56,0,0,1,1,2.47v15.4a3.51,3.51,0,0,1-1,2.47l-11.71,11.71a3,3,0,0,0-.89,2.14v.94a3,3,0,0,0,3,3h7.33A5.76,5.76,0,0,0,123.25,105.85ZM112,102.5l11.71-11.71a5.74,5.74,0,0,0,1.7-4.11V71.28a5.77,5.77,0,0,0-1.7-4.11L112,55.46h0a.71.71,0,0,1-.21-.49V54a.7.7,0,0,1,.7-.7h7.33a3.44,3.44,0,0,1,2,.67l33.47,24.43a.69.69,0,0,1,0,1.12L121.88,104a3.44,3.44,0,0,1-2,.67H112.5a.7.7,0,0,1-.7-.7V103A.71.71,0,0,1,112,102.5Z"/>
                </g>
            </g>
        </g>
    </g>
</svg>

<svg id="handleContainer" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 157.96 157.96">
    <title>Asset 43</title>
    <g id="Layer_2" data-name="Layer 2">
        <g id="UI">
            <g>
                <g id="handle">
                    <g class="cls-1">
                        <path class="cls-3" d="M79,107.71a8,8,0,0,1-5.66-2.35L52.6,84.64a8,8,0,0,1,0-11.32L73.32,52.6a8,8,0,0,1,11.32,0l20.72,20.72a8,8,0,0,1,0,11.32L84.64,105.36A8,8,0,0,1,79,107.71Z"/>
                    </g>
                    <path class="cls-4" d="M79,52.26A6,6,0,0,1,83.22,54L104,74.74a6,6,0,0,1,0,8.48L83.22,104a6,6,0,0,1-8.48,0L54,83.22a6,6,0,0,1,0-8.48L74.74,54A6,6,0,0,1,79,52.26m0-4a10,10,0,0,0-7.07,2.92L51.18,71.91a10,10,0,0,0,0,14.14l20.73,20.73a10,10,0,0,0,14.14,0l20.73-20.73a10,10,0,0,0,0-14.14L86.05,51.18A10,10,0,0,0,79,48.26Z"/>
                </g>
            </g>
        </g>
    </g>
</svg>

<script>
    try {
        var realityInterface = new RealityInterface();
        var envelopeContents = new EnvelopeContents(realityInterface, document.body); // just initializing this makes it compatible with envelopes
        realityInterface.setMoveDelay(1000);
    } catch (e) {
        console.warn('Reality Interface is not accessible');
    }

    var handleContainer = document.querySelector('#handleContainer');
    var handle = document.querySelector('#handle');

    var handleContainerRect = handleContainer.getClientRects()[0];
    // noinspection JSSuspiciousNameCombination
    var handleHeight = 270; // can't figure out how to programmatically get this from the path element, so hard-coded
    var handleWidth = handleHeight;
    
    var minY = handleContainerRect.top - handleContainerRect.height/2 + handleHeight/2;
    var maxY = handleContainerRect.bottom - handleContainerRect.height/2 - handleHeight/2;

    // works because slider-2d is square/symmetric
    var minX = minY;
    var maxX = maxY;

    var properties = {
        valueX: 0.5,
        valueY: 0.5
    };

    var isMouseDown = false;
    var handleOffsetX = 0;
    var handleOffsetY = 0;

    handle.addEventListener('pointerdown', function(e) {
        isMouseDown = true;
        var currentHandleContainerRect = handleContainer.getClientRects()[0];
        handleOffsetX = e.pageX - (currentHandleContainerRect.left + currentHandleContainerRect.width/2);
        handleOffsetY = e.pageY - (currentHandleContainerRect.top + currentHandleContainerRect.height/2);
    });

    document.addEventListener('pointermove', function(e) {
        if (isMouseDown) {

            // compute X position and value

            var newX = e.pageX - (handleContainerRect.left + handleContainerRect.width/2) - handleOffsetX;
            newX = Math.max(minX, Math.min(maxX, newX));
            handleContainer.style.left = newX + 'px';
            var percentX = (newX - minX) / (maxX - minX);

            if (percentX !== properties.valueX) { // don't resend same x value
                console.log(percentX);
                properties.valueX = percentX;

                try {
                    realityInterface.write('valueX', properties.valueX);
                } catch (e) {
                    console.warn('Reality Interface is not accessible');
                }
            }

            // compute Y position and value

            var newY = e.pageY - (handleContainerRect.top + handleContainerRect.height/2) - handleOffsetY;
            newY = Math.max(minY, Math.min(maxY, newY));
            handleContainer.style.top = newY + 'px';
            var percentY = 1 - (newY - minY) / (maxY - minY);

            if (percentY !== properties.valueY) { // don't resend same y value
                console.log(percentY);
                properties.valueY = percentY;

                try {
                    realityInterface.write('valueY', properties.valueY);
                } catch (e) {
                    console.warn('Reality Interface is not accessible');
                }
            }

        }
    });

    function renderProperties() {
        // set the the handle's x position to match valueX
        var newX = (maxX - minX) * (properties.valueX) + minX;
        newX = Math.max(minX, Math.min(maxX, newX));
        handleContainer.style.left = newX + 'px';
        
        // set the the handle's y position to match valueY
        var newY = (maxY - minY) * (1 - properties.valueY) + minY;
        newY = Math.max(minY, Math.min(maxY, newY));
        handleContainer.style.top = newY + 'px';
    }

    document.addEventListener('pointerup', function() {
        isMouseDown = false;
        handleOffsetX = 0;
        handleOffsetY = 0;
    });

    try {
        realityInterface.addReadListener('valueX', function(e) {
            properties.value = e.valueX;
            renderProperties();
        });

        realityInterface.addReadListener('valueY', function(e) {
            properties.value = e.valueY;
            renderProperties();
        });
        
    } catch (e) {
        console.warn('Reality Interface is not accessible');

        // test suite for in-browser simulation without loading in AR
        function mockReadListenerTriggerX(e) {
            properties.valueX = e;
            renderProperties();
        }
        function mockReadListenerTriggerY(e) {
            properties.valueY = e;
            renderProperties();
        }
    }
</script>

</body>
</html>
